graph zerodisk_overview {
  label="0-Disk Overview"
  colorscheme=accent4

  ardb [label="ardb cluster" shape=cylinder]

  user
    [shape=egg colorscheme=accent3]
  zeroctl
    [shape=rectangle colorscheme=accent4 
    color=1 style=filled]

  user -- zeroctl [label="CLI"]
  zeroctl -- ardb [label="r/w"]
  ardb -- nbdStorage [label="r/w"]

  zerostor [label="0-stor" shape=cylinder]
  zerostor -- tlogserver [label="write"]

  subgraph clusterTlog {
    color=3
    style=filled
    label="tlog module"

    tlogserver [shape=rectangle]

    subgraph clusterTlogClient {
      style=dotted
      color=transparent
      label="tlogclient module"

      tlogclient
      tlogplayer
    }

    tlogclient -- tlogserver
  }

  subgraph clusterNBD {
    color=2
    style=filled
    label="nbd module"

    nbdserver [
      shape = "rectangle"
    ]

    gonbdserver [
      label = "gonbdserver/nbd\nmodule"
    ]

    nbdBackend [label="nbd backend"]
    nbdStorage [label="BlockStorage"]
  
    nbdserver -- gonbdserver
    nbdBackend -- nbdStorage
    gonbdserver -- nbdBackend
    nbdStorage -- tlogplayer [label="write"]
    nbdStorage -- tlogclient
      [label="boot/db" style="dashed"]
  }

  tlogplayer -- zerostor [label="read"]
  zeroctl -- tlogplayer
  zeroctl -- nbdStorage [label="import/export"]

  user -- nbdserver [label="NBD Protocol"]
}
